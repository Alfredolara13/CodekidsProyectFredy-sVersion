<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Misiones - CodeKids</title>
    <script>
        try {
            const t = localStorage.getItem('"'"'app-theme'"'"');
            if (t === '"'"'dark'"'"') document.documentElement.classList.add('"'"'theme-dark'"'"', '"'"'dark'"'"');
        } catch(e) {}
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/dashboard-enhancements.css">
    <link rel="stylesheet" href="../css/tareas-enhancements.css">
</head>
<body class="bg-gray-50">
    <script type="module">
        import '"'"'../js/firebase-init.js'"'"';
        import { initStudentShell } from '"'"'../js/student-shell.js'"'"';
        import { initAuth } from '"'"'../js/auth.js'"'"';
        import { collection, query, where, getDocs, doc, getDoc, setDoc, addDoc } from '"'"'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js'"'"';

        initStudentShell('"'"'tareas'"'"');

        let currentUserData = null;
        let currentStudentTaskId = null;
        let currentStudentTaskData = null;

        initAuth((_u, uData) => {
            currentUserData = uData;
            initTareas();
        });t currentStudentTaskData = null;
        
        function initTareas(){
            console.log('ðŸ“ Inicializando vista de tareas para estudiante');
            
            // Event listeners
            document.getElementById('closeStudentTaskDetailModal')?.addEventListener('click', () => closeStudentTaskDetailModal());
            document.getElementById('cancelSubmitTask')?.addEventListener('click', () => closeSubmitTaskModal());
            document.getElementById('submitTaskForm')?.addEventListener('submit', handleStudentTaskSubmit);
            
            // Filtros
            document.querySelectorAll('input[name="studentTaskFilter"]').forEach(radio => {
                radio.addEventListener('change', () => loadStudentTasks());
            });
            
            // Cargar tareas del estudiante
            loadStudentTasks();
        }
        
        // ========== LABORATORIO - JUEGOS ==========
        function initLaboratorio(){
            // Blocky
            const grid = document.getElementById('blockyGrid');
            if (!grid) {
                console.warn('âš ï¸ Grid de Blocky no encontrado');
                return;
            }
            
            const status = document.getElementById('blockyStatus');
            const SIZE=5; const GOAL={x:4,y:4}; let pos={x:0,y:0}; let dir=0; // 0E 1S 2O 3N
            function draw(){
                grid.innerHTML='';
                for(let y=0;y<SIZE;y++){
                    for(let x=0;x<SIZE;x++){
                        const cell=document.createElement('div');
                        cell.className='aspect-square rounded flex items-center justify-center text-xs border';
                        if (x===GOAL.x && y===GOAL.y) { cell.classList.add('bg-green-100'); cell.textContent='ðŸ'; }
                        if (x===pos.x && y===pos.y) { cell.classList.add('bg-indigo-100'); cell.textContent = ['â†’','â†“','â†','â†‘'][dir]; }
                        grid.appendChild(cell);
                    }
                }
                if (status) status.textContent = `Pos (${pos.x},${pos.y}) Â· Dir ${['E','S','O','N'][dir]}`;
            }
            function reset(){ pos={x:0,y:0}; dir=0; draw(); }
            function move(){ const nx=pos.x + (dir===0?1:dir===2?-1:0); const ny=pos.y + (dir===1?1:dir===3?-1:0); if(nx<0||ny<0||nx>=SIZE||ny>=SIZE) return; pos={x:nx,y:ny}; draw(); check(); }
            function turn(){ dir=(dir+1)%4; draw(); }
            function check(){ if (pos.x===GOAL.x && pos.y===GOAL.y){ if(window.userState) window.userState.completeGame('blocky', 100); addXP(25,'blocky'); if(window.updateGamificationHeader) updateGamificationHeader(window.userState?.state?.xp||0); alert('Â¡Ganaste Blocky! +25 XP'); reset(); } }
            document.getElementById('btnMove')?.addEventListener('click', move);
            document.getElementById('btnTurn')?.addEventListener('click', turn);
            document.getElementById('btnResetBlocky')?.addEventListener('click', reset);
            draw();

            // Typo Racer
            const targets = [ 'print("Hola")', 'for i in range(5):', 'if x == 10:', 'def suma(a,b):' ];
            let tStart=0; let target='';
            const tEl = document.getElementById('typoTarget');
            const inEl = document.getElementById('typoInput');
            const accEl = document.getElementById('typoAccuracy');
            const wpmEl = document.getElementById('typoWpm');
            const stEl = document.getElementById('typoStatus');
            
            if (!tEl || !inEl) {
                console.warn('âš ï¸ Elementos de Typo Racer no encontrados');
                return;
            }
            
            function newTarget(){ target = targets[Math.floor(Math.random()*targets.length)]; tEl.textContent = target; inEl.value=''; inEl.focus(); tStart=Date.now(); stEl.textContent='Escribe la lÃ­nea...'; accEl.textContent='PrecisiÃ³n: 0%'; wpmEl.textContent='WPM: 0'; }
            function compute(){
                const val = inEl.value;
                const len = Math.max(val.length, target.length);
                let ok=0; for(let i=0;i<Math.min(val.length,target.length);i++){ if(val[i]===target[i]) ok++; }
                const acc = Math.round((ok/len)*100);
                const mins = (Date.now()-tStart)/60000;
                const wpm = Math.max(0, Math.round((val.length/5)/Math.max(mins, 0.01)));
                accEl.textContent = `PrecisiÃ³n: ${isFinite(acc)?acc:0}%`;
                wpmEl.textContent = `WPM: ${isFinite(wpm)?wpm:0}`;
                if (val === target) {
                    addXP(15,'typo-racer'); 
                    if(window.userState) window.userState.completeGame('typo', wpm); 
                    if(window.updateGamificationHeader) updateGamificationHeader(window.userState?.state?.xp||0); 
                    stEl.textContent='Â¡Perfecto! +15 XP'; 
                    setTimeout(newTarget, 700); 
                }
            }
            inEl.addEventListener('input', compute);
            newTarget();
        }
        
        async function loadStudentTasks() {
            const user = window.currentUser || window.auth?.currentUser;
            if (!user) {
                console.warn('âš ï¸ No hay usuario autenticado');
                return;
            }
            
            try {
                console.log('ðŸ” Cargando tareas del estudiante:', user.uid);
                
                // 1. Obtener grupos del estudiante
                const groupsRef = collection(window.db, 'groups');
                const groupsQuery = query(groupsRef, where('studentIds', 'array-contains', user.uid));
                const groupsSnapshot = await getDocs(groupsQuery);
                
                const studentGroupIds = groupsSnapshot.docs.map(doc => doc.id);
                console.log('ðŸ“Š Grupos del estudiante:', studentGroupIds);
                
                if (studentGroupIds.length === 0) {
                    document.getElementById('studentTasksList').innerHTML = `
                        <div class="text-center text-gray-400 py-12">
                            <div class="text-6xl mb-4">ðŸ“</div>
                            <p class="text-lg mb-2">No tienes tareas asignadas</p>
                            <p class="text-sm">No estÃ¡s en ningÃºn grupo aÃºn</p>
                        </div>
                    `;
                    return;
                }
                
                // 2. Obtener todas las tareas de esos grupos
                const tasksRef = collection(window.db, 'tasks');
                const tasksQuery = query(tasksRef, where('groupId', 'in', studentGroupIds));
                const tasksSnapshot = await getDocs(tasksQuery);
                
                console.log('ðŸ“Š Tareas encontradas:', tasksSnapshot.size);
                
                if (tasksSnapshot.empty) {
                    document.getElementById('studentTasksList').innerHTML = `
                        <div class="text-center text-gray-400 py-12">
                            <div class="text-6xl mb-4">ðŸ“</div>
                            <p class="text-lg mb-2">No tienes tareas asignadas</p>
                            <p class="text-sm">Tu profesor crearÃ¡ tareas pronto</p>
                        </div>
                    `;
                    return;
                }
                
                // 3. Procesar tareas con sus entregas
                const filter = document.querySelector('input[name="studentTaskFilter"]:checked')?.value || 'all';
                const tasks = [];
                
                for (const taskDoc of tasksSnapshot.docs) {
                    const task = taskDoc.data();
                    const taskId = taskDoc.id;
                    
                    // Verificar si tiene entrega
                    const submissionDoc = await getDoc(doc(window.db, 'tasks', taskId, 'submissions', user.uid));
                    const submission = submissionDoc.exists() ? submissionDoc.data() : null;
                    
                    const status = submission ? (submission.status === 'graded' ? 'graded' : 'submitted') : 'pending';
                    
                    // Aplicar filtro
                    if (filter === 'pending' && status !== 'pending') continue;
                    if (filter === 'submitted' && status !== 'submitted') continue;
                    if (filter === 'graded' && status !== 'graded') continue;
                    
                    tasks.push({ id: taskId, ...task, submission, status });
                }
                
                // 4. Renderizar tareas
                const container = document.getElementById('studentTasksList');
                container.innerHTML = '';
                
                if (tasks.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-gray-400 py-8">
                            <p>No hay tareas en esta categorÃ­a</p>
                        </div>
                    `;
                    return;
                }
                
                // Ordenar por fecha de vencimiento
                tasks.sort((a, b) => {
                    const dateA = a.dueDate?.toDate ? a.dueDate.toDate() : new Date(a.dueDate);
                    const dateB = b.dueDate?.toDate ? b.dueDate.toDate() : new Date(b.dueDate);
                    return dateA - dateB;
                });
                
                for (const task of tasks) {
                    const taskCard = await createStudentTaskCard(task);
                    container.insertAdjacentHTML('beforeend', taskCard);
                }
                
                // Event listeners
                container.querySelectorAll('.student-task-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const taskId = card.dataset.taskId;
                        openStudentTaskDetail(taskId);
                    });
                });
                
                console.log('âœ… Tareas del estudiante renderizadas');
            } catch (error) {
                console.error('âŒ Error cargando tareas:', error);
                document.getElementById('studentTasksList').innerHTML = `
                    <div class="text-center text-red-400 py-12">
                        <p class="text-lg mb-2">Error cargando tareas</p>
                        <p class="text-sm">${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function createStudentTaskCard(task) {
            const dueDate = task.dueDate?.toDate ? task.dueDate.toDate() : new Date(task.dueDate);
            const now = new Date();
            const isPast = dueDate < now;
            const timeLeft = getTimeLeft(dueDate);
            
            // Obtener nombre del grupo
            let groupName = 'Grupo';
            try {
                const groupDoc = await getDoc(doc(window.db, 'groups', task.groupId));
                if (groupDoc.exists()) {
                    groupName = groupDoc.data().name;
                }
            } catch (error) {
                console.error('Error obteniendo grupo:', error);
            }
            
            // Estados
            let statusBadge = '';
            let statusColor = '';
            if (task.status === 'graded') {
                statusBadge = 'ðŸŸ¢ Calificada';
                statusColor = 'bg-green-100 text-green-700';
            } else if (task.status === 'submitted') {
                statusBadge = 'ðŸŸ¡ Entregada';
                statusColor = 'bg-yellow-100 text-yellow-700';
            } else {
                statusBadge = isPast ? 'ðŸ”´ Vencida' : 'âšª Pendiente';
                statusColor = isPast ? 'bg-red-100 text-red-700' : 'bg-gray-100 text-gray-700';
            }
            
            return `
                <div class="student-task-card card hover-lift cursor-pointer transition-all ${isPast && task.status === 'pending' ? 'border-l-4 border-red-500' : ''}" data-task-id="${task.id}">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-gray-800 mb-1">${task.title}</h3>
                            <p class="text-sm text-gray-600 line-clamp-2">${task.description}</p>
                        </div>
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusColor}">
                            ${statusBadge}
                        </span>
                    </div>
                    <div class="space-y-2 text-sm text-gray-600">
                        <div class="flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            <span>${groupName}</span>
                        </div>
                        <div class="flex items-center gap-2 ${isPast && task.status === 'pending' ? 'text-red-600 font-semibold' : ''}">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>${timeLeft}</span>
                        </div>
                        ${task.status === 'graded' ? `
                            <div class="flex items-center justify-between pt-2 border-t border-gray-100">
                                <span class="text-indigo-600 font-bold text-lg">${task.submission.grade}/${task.maxPoints} pts</span>
                                <span class="text-green-600 font-semibold">+${calculateXP(task.submission.grade, task.maxPoints)} XP</span>
                            </div>
                        ` : `
                            <div class="pt-2 border-t border-gray-100">
                                <span class="text-gray-500">${task.maxPoints} puntos</span>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }
        
        function getTimeLeft(dueDate) {
            const now = new Date();
            const diff = dueDate - now;
            
            if (diff < 0) {
                return 'â° Tiempo vencido';
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            if (days > 0) {
                return `â³ Vence en ${days}d ${hours}h`;
            } else if (hours > 0) {
                return `â³ Vence en ${hours}h ${minutes}m`;
            } else {
                return `âš ï¸ Vence en ${minutes}m`;
            }
        }
        
        function calculateXP(grade, maxPoints) {
            const percentage = (grade / maxPoints) * 100;
            let xp = 50; // Base XP
            
            if (percentage >= 90) {
                xp += 30; // Bonus
            } else if (percentage >= 80) {
                xp += 20;
            } else if (percentage >= 70) {
                xp += 10;
            }
            
            return xp;
        }
        
        async function openStudentTaskDetail(taskId) {
            currentStudentTaskId = taskId;
            const user = window.currentUser || window.auth?.currentUser;
            if (!user) return;
            
            try {
                const taskDoc = await getDoc(doc(window.db, 'tasks', taskId));
                if (!taskDoc.exists()) return;
                
                const task = taskDoc.data();
                currentStudentTaskData = task;
                
                // Obtener entrega si existe
                const submissionDoc = await getDoc(doc(window.db, 'tasks', taskId, 'submissions', user.uid));
                const submission = submissionDoc.exists() ? submissionDoc.data() : null;
                
                // Obtener nombre del grupo
                let groupName = 'Grupo';
                const groupDoc = await getDoc(doc(window.db, 'groups', task.groupId));
                if (groupDoc.exists()) {
                    groupName = groupDoc.data().name;
                }
                
                const dueDate = task.dueDate?.toDate ? task.dueDate.toDate() : new Date(task.dueDate);
                const status = submission ? (submission.status === 'graded' ? 'graded' : 'submitted') : 'pending';
                
                // Actualizar informaciÃ³n
                document.getElementById('studentTaskDetailTitle').textContent = task.title;
                document.getElementById('studentTaskDetailGroup').textContent = groupName;
                document.getElementById('studentTaskDetailDescription').textContent = task.description;
                document.getElementById('studentTaskDetailInstructions').textContent = task.instructions || 'Sin instrucciones adicionales';
                document.getElementById('studentTaskDetailDueDate').textContent = dueDate.toLocaleDateString('es-MX', {
                    year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'
                });
                document.getElementById('studentTaskDetailPoints').textContent = `${task.maxPoints} puntos`;
                
                // Estado
                let statusBadge = '';
                let statusColor = '';
                if (status === 'graded') {
                    statusBadge = 'ðŸŸ¢ Calificada';
                    statusColor = 'bg-green-100 text-green-700';
                } else if (status === 'submitted') {
                    statusBadge = 'ðŸŸ¡ Entregada';
                    statusColor = 'bg-yellow-100 text-yellow-700';
                } else {
                    statusBadge = 'âšª Pendiente';
                    statusColor = 'bg-gray-100 text-gray-700';
                }
                document.getElementById('studentTaskDetailStatus').textContent = statusBadge;
                document.getElementById('studentTaskDetailStatus').className = `px-2 py-1 text-xs font-semibold rounded-full ${statusColor}`;
                
                // Countdown
                updateCountdown(dueDate);
                
                // Estado de entrega
                const statusContainer = document.getElementById('studentTaskSubmissionStatus');
                const submitBtn = document.getElementById('studentTaskSubmitBtn');
                
                if (submission) {
                    statusContainer.innerHTML = `
                        <div class="p-4 rounded-lg ${submission.status === 'graded' ? 'bg-green-50 border border-green-200' : 'bg-yellow-50 border border-yellow-200'}">
                            <div class="flex items-start gap-3">
                                <div class="text-2xl">${submission.status === 'graded' ? 'âœ…' : 'ðŸ“¤'}</div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-800 mb-2">
                                        ${submission.status === 'graded' ? 'Tarea Calificada' : 'Tarea Entregada'}
                                    </h4>
                                    <p class="text-sm text-gray-600 mb-2">
                                        Entregado: ${submission.submittedAt?.toDate ? submission.submittedAt.toDate().toLocaleDateString('es-MX', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : 'Fecha desconocida'}
                                    </p>
                                    ${submission.attachmentUrl ? `
                                        <a href="${submission.attachmentUrl}" target="_blank" class="text-sm text-indigo-600 hover:underline flex items-center gap-1">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
                                            </svg>
                                            Ver mi entrega
                                        </a>
                                    ` : ''}
                                    ${submission.status === 'graded' ? `
                                        <div class="mt-3 pt-3 border-t border-green-200">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-sm font-semibold text-gray-700">CalificaciÃ³n:</span>
                                                <span class="text-2xl font-bold text-indigo-600">${submission.grade}/${task.maxPoints}</span>
                                            </div>
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-sm font-semibold text-gray-700">XP Ganado:</span>
                                                <span class="text-lg font-bold text-green-600">+${calculateXP(submission.grade, task.maxPoints)} XP</span>
                                            </div>
                                            ${submission.feedback ? `
                                                <div class="mt-2">
                                                    <span class="text-sm font-semibold text-gray-700">Comentarios del profesor:</span>
                                                    <p class="text-sm text-gray-600 mt-1 p-2 bg-white rounded border border-green-100">${submission.feedback}</p>
                                                </div>
                                            ` : ''}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                    submitBtn.style.display = 'none';
                } else {
                    statusContainer.innerHTML = '';
                    submitBtn.style.display = 'block';
                }
                
                // Mostrar modal
                document.getElementById('studentTaskDetailModal').classList.remove('hidden');
            } catch (error) {
                console.error('Error cargando detalle de tarea:', error);
            }
        }
        
        function updateCountdown(dueDate) {
            const countdownEl = document.getElementById('studentTaskDetailCountdown');
            
            function update() {
                const timeLeft = getTimeLeft(dueDate);
                countdownEl.textContent = timeLeft;
            }
            
            update();
            setInterval(update, 60000); // Actualizar cada minuto
        }
        
        function closeStudentTaskDetailModal() {
            document.getElementById('studentTaskDetailModal').classList.add('hidden');
            currentStudentTaskId = null;
            currentStudentTaskData = null;
        }
        
        window.openSubmitTaskModal = function() {
            document.getElementById('submitTaskModal').classList.remove('hidden');
        };
        
        function closeSubmitTaskModal() {
            document.getElementById('submitTaskModal').classList.add('hidden');
            document.getElementById('submitTaskForm').reset();
        }
        
        async function handleStudentTaskSubmit(e) {
            e.preventDefault();
            const user = window.currentUser || window.auth?.currentUser;
            if (!user || !currentStudentTaskId) return;
            
            const attachmentUrl = document.getElementById('submissionLink').value.trim();
            
            try {
                const submissionData = {
                    status: 'submitted',
                    submittedAt: new Date(),
                    attachmentUrl: attachmentUrl
                };
                
                await setDoc(doc(window.db, 'tasks', currentStudentTaskId, 'submissions', user.uid), submissionData);
                
                // Otorgar XP por entregar (usando sistema global de gamificación)
                if (window.addXP) {
                    await window.addXP(50, 'task_submit');
                    console.log('✅ Sumados 50 XP por entregar tarea');
                }
                
                // Enviar notificaciÃ³n al profesor
                const taskData = currentStudentTaskData;
                await sendNotification(taskData.teacherId, {
                    type: 'task_submitted',
                    title: 'ðŸ“¤ Nueva entrega',
                    message: `${user.displayName || 'Un estudiante'} ha entregado la tarea "${taskData.title}"`,
                    taskId: currentStudentTaskId,
                    createdAt: new Date()
                });
                
                alert('âœ… Tarea entregada correctamente. Has ganado 50 XP!');
                closeSubmitTaskModal();
                closeStudentTaskDetailModal();
                await loadStudentTasks();
                
                // Actualizar header de gamificaciÃ³n
                if (window.updateGamificationHeader) {
                    const userDoc = await getDoc(doc(window.db, 'users', user.uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        window.updateGamificationHeader(userData.xp || 0);
                    }
                }
            } catch (error) {
                console.error('Error entregando tarea:', error);
                alert('âŒ Error al entregar la tarea');
            }
        }
        
        // FunciÃ³n para enviar notificaciones
        // Función para enviar notificaciones
        async function sendNotification(userId, notificationData) {
            try {
                await addDoc(collection(window.db, 'users', userId, 'notifications'), notificationData);
                console.log('📬 Notificación enviada a:', userId);
            } catch (error) {
                console.error('Error enviando notificación:', error);
            }
        }

        window.openSubmitTaskModal = openSubmitTaskModal;
    </script>

    <main class="flex-1 md:ml-64 p-6 pt-20">
        <div class="mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2"> Mis Misiones</h1>
            <p class="text-gray-600">Misiones asignadas por tus profesores</p>
        </div>

        <!-- Filtros -->
        <div class="card mb-6 p-4">
            <div class="flex items-center gap-4">
                <span class="text-sm font-semibold text-gray-700">Filtrar:</span>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="studentTaskFilter" value="all" checked class="form-radio text-indigo-600">
                    <span class="text-sm">Todas</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="studentTaskFilter" value="pending" class="form-radio text-indigo-600">
                    <span class="text-sm">Pendientes</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="studentTaskFilter" value="submitted" class="form-radio text-indigo-600">
                    <span class="text-sm">Entregadas</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="studentTaskFilter" value="graded" class="form-radio text-indigo-600">
                    <span class="text-sm">Calificadas</span>
                </label>
            </div>
        </div>

        <!-- Lista de Tareas -->
        <div id="studentTasksList" class="space-y-4">
            <div class="text-center text-gray-400 py-12">
                <div class="text-6xl mb-4"></div>
                <p class="text-lg mb-2">Cargando tareas...</p>
            </div>
        </div>

        <!-- Modal Detalle de Tarea (Estudiante) -->
        <div id="studentTaskDetailModal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-white border-b border-gray-200 p-6">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h2 id="studentTaskDetailTitle" class="text-2xl font-bold text-gray-800 mb-2"></h2>
                            <div class="flex items-center gap-4 text-sm">
                                <span id="studentTaskDetailGroup" class="text-gray-600"></span>
                                <span id="studentTaskDetailStatus" class="px-2 py-1 text-xs font-semibold rounded-full"></span>
                            </div>
                        </div>
                        <button id="closeStudentTaskDetailModal" class="text-gray-400 hover:text-gray-600 text-2xl font-bold"></button>
                    </div>
                </div>

                <div class="p-6 space-y-6">
                    <!-- Descripción -->
                    <div>
                        <h3 class="text-lg font-bold text-gray-800 mb-2"> Descripción</h3>
                        <p id="studentTaskDetailDescription" class="text-gray-700"></p>
                    </div>

                    <!-- Instrucciones -->
                    <div>
                        <h3 class="text-lg font-bold text-gray-800 mb-2"> Instrucciones</h3>
                        <p id="studentTaskDetailInstructions" class="text-gray-700 whitespace-pre-wrap"></p>
                    </div>

                    <!-- Información -->
                    <div class="grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg">
                        <div>
                            <span class="text-sm text-gray-500">Fecha límite:</span>
                            <div id="studentTaskDetailDueDate" class="font-semibold text-gray-800"></div>
                            <div id="studentTaskDetailCountdown" class="text-sm text-indigo-600 mt-1"></div>
                        </div>
                        <div>
                            <span class="text-sm text-gray-500">Puntos:</span>
                            <div id="studentTaskDetailPoints" class="font-semibold text-gray-800"></div>
                        </div>
                    </div>

                    <!-- Estado de Entrega -->
                    <div id="studentTaskSubmissionStatus"></div>

                    <!-- Botón Entregar -->
                    <div id="studentTaskSubmitBtn">
                        <button onclick="window.openSubmitTaskModal()" class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition font-semibold">
                             Entregar Tarea
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Entregar Tarea -->
        <div id="submitTaskModal" class="hidden fixed inset-0 bg-black/60 z-[60] flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
                <div class="p-6 border-b border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800"> Entregar Tarea</h3>
                </div>

                <form id="submitTaskForm" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Enlace de entrega (Google Drive, OneDrive, etc.)
                        </label>
                        <input type="url" id="submissionLink" required
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                               placeholder="https://...">
                        <p class="text-xs text-gray-500 mt-1">Sube tu trabajo a la nube y pega el enlace aquí</p>
                    </div>

                    <div class="flex gap-3">
                        <button type="submit" class="flex-1 bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition font-semibold">
                            Enviar
                        </button>
                        <button type="button" id="cancelSubmitTask" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300 transition font-semibold">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>
</body>
</html>
