<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Perfil - CodeKids</title><script>try{const t=localStorage.getItem('app-theme');if(t==='dark')document.documentElement.classList.add('theme-dark','dark')}catch(e){}</script><script src="https://cdn.tailwindcss.com"></script><link rel="stylesheet" href="../css/style.css"></head><body class="bg-gray-50"><script type="module">import '../js/firebase-init.js';import { initStudentShell } from '../js/student-shell.js';import { initAuth } from '../js/auth.js';import { doc, getDoc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';import { getDownloadURL, ref, uploadBytes } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';initStudentShell('perfil');
let currentUserData=null;
initAuth((_u,uData)=>{ currentUserData=uData; renderFrames(uData); });
async function handleUpload(){ const inp=document.getElementById('avatarInput'); if(!inp.files.length) return; const file=inp.files[0]; const uid=window.auth.currentUser.uid; const storageRef = ref(window.storage, `users/${uid}/profile/avatar_${Date.now()}.jpg`); await uploadBytes(storageRef,file); const url=await getDownloadURL(storageRef); await updateDoc(doc(window.db,'users',uid), { photoURL: url }); alert('âœ… Avatar actualizado'); try{ document.getElementById('userAvatarShell').src=url; }catch(_){} }
function renderFrames(u){ const frames=[{id:'marco_bronce',name:'Marco Bronce',unlockLevel:2},{id:'marco_plata',name:'Marco Plata',unlockLevel:5},{id:'marco_oro',name:'Marco Oro',unlockLevel:8},{id:'marco_diamante',name:'Marco Diamante',unlockLevel:10}]; const unlocked=new Set(u.unlockedFrames||[]); const grid=document.getElementById('framesGrid'); grid.innerHTML = frames.map(f=>{ const can = unlocked.has(f.id) || (u.nivel||1)>=f.unlockLevel; const cls = `p-2 border rounded ${can?'cursor-pointer hover:bg-indigo-50':'opacity-60 bg-gray-50'}`; return `<div data-id='${f.id}' class='${cls}' title='Se desbloquea en Nivel ${f.unlockLevel}'>${f.name} (L${f.unlockLevel})</div>`; }).join(''); Array.from(grid.children).forEach(el=>{ el.addEventListener('click', async ()=>{ const id=el.getAttribute('data-id'); if(el.classList.contains('opacity-60')) return; const uid=window.auth.currentUser.uid; await updateDoc(doc(window.db,'users',uid), { selectedFrame: id }); alert('Marco seleccionado'); }); }); }
</script><main class="flex-1 md:ml-64 p-6 pt-20"><h1 class="text-3xl font-bold mb-4">Mi Perfil</h1><div class="grid md:grid-cols-2 gap-6"><div class="card"><h2 class="font-semibold mb-3">Cambiar Avatar</h2><input id="avatarInput" type="file" accept="image/*" class="form-input mb-3"/><button class="btn-primary-token text-sm" onclick="handleUpload()">Subir</button></div><div class="card"><h2 class="font-semibold mb-3">Marcos Desbloqueados</h2><div id="framesGrid" class="grid grid-cols-2 gap-3 text-sm"></div></div></div></main></body></html>